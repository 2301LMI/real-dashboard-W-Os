<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Work Order Board</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .board { display: flex; gap: 20px; overflow-x: auto; flex-wrap: nowrap; }
    .column {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 10px;
      min-width: 300px;
      flex-shrink: 0;
    }
    .column h2 { text-align: center; margin-top: 0; }
    .card {
      background: #fefefe;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .aging-yellow { background: #fff7cc; }
    .aging-red { background: #ffd6d6; }
    .aging-blue { background: #cce0ff; }
  </style>
  <script>
    function getAgingClass(days) {
      if (days >= 10) return 'aging-blue';
      if (days >= 7) return 'aging-red';
      if (days >= 3) return 'aging-yellow';
      return '';
    }

    function createCard(row) {
      const div = document.createElement('div');
      const days = parseInt(row[5]);
      div.className = 'card ' + getAgingClass(days);
      div.innerHTML = `
        <strong>W.O. ID:</strong> ${row[0]}<br>
        <strong>Name:</strong> ${row[1]}<br>
        <strong>Description:</strong> ${row[2]}<br>
        <strong>Status:</strong> ${row[3]}<br>
        <strong>Days in Status:</strong> ${days}
      `;
      return div;
    }

    function populateBoard(data) {
      const columns = {};
      document.querySelectorAll('.column').forEach(col => {
        columns[col.dataset.status] = col;
        col.innerHTML = `<h2>${col.dataset.status}</h2>`;
      });

      data.forEach(row => {
        const status = row[3];
        const card = createCard(row);
        if (columns[status]) columns[status].appendChild(card);
      });
    }

    async function fetchSheetData() {
      const url = "https://docs.google.com/spreadsheets/d/1w8cRczfapahc0PXOXm3Q_Ka0TGK0T0SR5B6M7h8M7Zc/gviz/tq?tqx=out:json";
      const res = await fetch(url);
      const text = await res.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows.map(r => r.c.map(c => (c ? c.v : '')));
      populateBoard(rows);
    }

    window.onload = fetchSheetData;
  </script>
</head>
<body>
  <h1>Live Work Order Board</h1>
  <div class="board">
    <div class="column" data-status="To Be Invoiced"><h2>To Be Invoiced</h2></div>
    <div class="column" data-status="Tech Working"><h2>Tech Working</h2></div>
    <div class="column" data-status="Service Scheduled"><h2>Service Scheduled</h2></div>
    <div class="column" data-status="Checked In"><h2>Checked In</h2></div>
    <div class="column" data-status="Triage"><h2>Triage</h2></div>
    <div class="column" data-status="Waiting for Parts"><h2>Waiting for Parts</h2></div>
    <div class="column" data-status="Warranty"><h2>Warranty</h2></div>
    <div class="column" data-status="Warranty Filed"><h2>Warranty Filed</h2></div>
    <div class="column" data-status="Manager Approval"><h2>Manager Approval</h2></div>
    <div class="column" data-status="Needs Prediagnosed"><h2>Needs Prediagnosed</h2></div>
    <div class="column" data-status="Parts Received"><h2>Parts Received</h2></div>
  </div>
</body>
</html>
